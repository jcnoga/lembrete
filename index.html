<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Compromisso F√°cil Cloud Pro</title>
    
    <!-- Bibliotecas PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    <!-- MANIFEST PWA -->
    <link rel="manifest" href="manifest.json">

    <!-- ARQUIVO DE ESTILOS -->
    <link rel="stylesheet" href="style.css">
</head>
<body onclick="enableAudio()">

    <!-- 1. TELA DE AUTENTICA√á√ÉO -->
    <div id="auth-screen">
        <div class="auth-box" id="login-form">
            <h2>Compromisso F√°cil</h2>
            <p style="margin-bottom: 20px; color: #666;">Sua agenda na nuvem.</p>
            
            <input type="email" id="log-email" class="auth-input" placeholder="Seu e-mail">
            <input type="password" id="log-pass" class="auth-input" placeholder="Sua senha">
            
            <button class="auth-btn" onclick="appLogin()">Entrar</button>

            <!-- LOGIN COM GOOGLE -->
            <div class="divider">
                <span></span><p>OU</p><span></span>
            </div>
            
            <button class="auth-btn btn-google" onclick="appLoginGoogle()">
                <svg class="google-icon" viewBox="0 0 48 48">
                    <path fill="#4285F4" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"></path>
                    <path fill="#34A853" d="M46.98 24.46c0-1.66-.15-3.21-.42-4.72H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.48z"></path>
                    <path fill="#FBBC05" d="M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"></path>
                    <path fill="#EA4335" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"></path>
                </svg>
                Entrar com Google
            </button>
            
            <div class="auth-link" onclick="toggleAuth('register')">Criar conta nova (E-mail)</div>
            <div class="auth-link" onclick="toggleAuth('reset')" style="color:#ddd;">Esqueci minha senha</div>
        </div>

        <div class="auth-box hidden" id="register-form">
            <h2>Criar Conta</h2>
            <p style="font-size:0.9rem; color:#777;">Preencha para acessar o sistema</p>
            <input type="email" id="reg-email" class="auth-input" placeholder="E-mail">
            <input type="password" id="reg-pass" class="auth-input" placeholder="Senha (min 6)">
            <button class="auth-btn" onclick="appRegister()">Cadastrar</button>
            <div class="auth-link" onclick="toggleAuth('login')">Voltar para Login</div>
        </div>

        <div class="auth-box hidden" id="reset-form">
            <h2>Recuperar Senha</h2>
            <p style="font-size:0.9rem; color:#777; margin-bottom:15px;">Digite seu e-mail para receber o link de redefini√ß√£o.</p>
            <input type="email" id="reset-email" class="auth-input" placeholder="E-mail cadastrado">
            <button class="auth-btn" onclick="appResetPassword()">Enviar Link</button>
            <div class="auth-link" onclick="toggleAuth('login')">Cancelar</div>
        </div>
    </div>

    <!-- 2. APP PRINCIPAL -->
    <div id="app-screen" class="hidden">
        <header>
            <div class="app-name">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                Compromisso F√°cil
            </div>
            <div class="user-status">
                <span id="user-display"></span>
                <button onclick="appLogout()" style="background:none; border:none; cursor:pointer; font-size:1.2rem; color:var(--danger);" title="Sair">üö™</button>
            </div>
        </header>

        <main>
            <!-- VIEW: DASHBOARD -->
            <div id="view-dashboard" class="view-section">
                <div class="dashboard-grid">
                    <div class="card welcome-card">
                        <h2 id="greeting">Ol√°!</h2>
                        <p>Suas tarefas est√£o sincronizadas na nuvem.</p>
                    </div>
                    <div class="card card-stat">
                        <h3 id="stat-pending">0</h3>
                        <p>Pendentes</p>
                    </div>
                    <!-- Clientes (Receita) -->
                    <div class="card card-stat">
                        <h3 id="stat-revenue" style="color: var(--secondary);">R$ 0</h3>
                        <p>A Receber (Cliente)</p>
                    </div>
                    <!-- Fornecedores (Despesa) -->
                    <div class="card card-stat">
                        <h3 id="stat-expense" style="color: var(--danger);">R$ 0</h3>
                        <p>A Pagar (Fornecedor)</p>
                    </div>
                </div>
                <div class="section-title">
                    <h3>Para Hoje</h3>
                    <a href="#" onclick="switchTab('tasks')" style="color:var(--primary); text-decoration:none;">Ver todas</a>
                </div>
                <div id="dashboard-list"></div>

                <!-- BOT√ÉO DE APOIO DISCRETO -->
                <div style="margin-top: 40px; text-align: center;">
                    <button onclick="openSupportModal()" style="background: white; color: var(--primary); border: 2px solid #f1c40f; padding: 10px 25px; border-radius: 50px; font-weight: bold; font-size: 0.9rem; cursor: pointer; box-shadow: var(--shadow);">
                        Apoiar üíõ
                    </button>
                </div>
            </div>

            <!-- VIEW: CALENDAR -->
            <div id="view-calendar" class="view-section hidden">
                <div class="section-title">
                    <h3 id="calendar-month-year">M√™s</h3>
                    <div style="display:flex; gap:10px;">
                        <button class="btn-icon" onclick="changeMonth(-1)">‚óÄ</button>
                        <button class="btn-icon" onclick="changeMonth(1)">‚ñ∂</button>
                    </div>
                </div>
                <div class="calendar-grid">
                    <div class="cal-day-header">D</div><div class="cal-day-header">S</div><div class="cal-day-header">T</div><div class="cal-day-header">Q</div><div class="cal-day-header">Q</div><div class="cal-day-header">S</div><div class="cal-day-header">S</div>
                </div>
                <div id="calendar-days" class="calendar-grid"></div>
                <div style="margin-top:20px;">
                    <h4>Tarefas do dia:</h4>
                    <div id="calendar-task-list" style="margin-top:10px;">Selecione um dia</div>
                </div>
            </div>

            <!-- VIEW: TASKS -->
            <div id="view-tasks" class="view-section hidden">
                <div class="section-title">
                    <h3>Todas as Tarefas</h3>
                </div>
                
                <!-- Nova √Årea de Filtros -->
                <div class="filters-box" style="display:flex; gap:10px; margin-bottom:20px;">
                    <input type="text" id="task-search" class="form-control" placeholder="üîç Buscar por t√≠tulo..." oninput="renderTasks()" style="flex: 2;">
                    
                    <select id="filter-category" class="form-control" style="flex: 1; padding:5px;" onchange="renderTasks()">
                        <option value="all">Todas</option>
                        <option value="Trabalho">Trabalho</option>
                        <option value="Pessoal">Pessoal</option>
                        <option value="Cliente">Clientes</option>
                        <option value="Fornecedor">Fornecedor</option>
                    </select>
                </div>

                <div id="tasks-list"></div>
            </div>

            <!-- VIEW: SETTINGS -->
            <div id="view-settings" class="view-section hidden">
                <h3>Mais Op√ß√µes</h3>
                
                <!-- CONFIGURA√á√ÉO DEFAULT DE ALERTAS -->
                <div class="card" style="margin-top:15px; border:1px solid #cce5ff;">
                    <p style="margin-top:0; color:var(--primary-dark); font-weight:bold;">üõ†Ô∏è Configura√ß√£o Padr√£o de Alertas</p>
                    <p style="font-size:0.8rem; color:#666;">Esses valores ser√£o usados automaticamente em novas tarefas.</p>
                    
                    <div class="advanced-settings" style="background:white; border:none; padding:0;">
                        <h4 style="font-size:0.8rem;">‚è∞ Alarme (Sonoro)</h4>
                        <div class="row">
                            <div class="col">
                                <label>Iniciar (min antes)</label>
                                <input type="number" id="def-alarm-start" class="form-control" placeholder="15">
                            </div>
                            <div class="col">
                                <label>Repetir (cada min)</label>
                                <input type="number" id="def-alarm-freq" class="form-control" placeholder="5">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label>Se atrasado (cada min)</label>
                                <input type="number" id="def-alarm-over-freq" class="form-control" placeholder="10">
                            </div>
                        </div>

                        <h4 style="font-size:0.8rem; margin-top:10px;">üìß E-mail</h4>
                        <div class="row">
                            <div class="col">
                                <label>Iniciar (dias antes)</label>
                                <input type="number" id="def-mail-days" class="form-control" placeholder="1">
                            </div>
                            <div class="col">
                                <label>Repetir (cada dias)</label>
                                <input type="number" id="def-mail-freq" class="form-control" placeholder="1">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col">
                                <label>Se atrasado (cada dias)</label>
                                <input type="number" id="def-mail-over-freq" class="form-control" placeholder="1">
                            </div>
                            <div class="col">
                                <label>Max Envios Atrasados</label>
                                <input type="number" id="def-mail-over-max" class="form-control" placeholder="3">
                            </div>
                        </div>
                        <button class="btn-block btn-primary" onclick="saveDefaultSettings()">Salvar Padr√µes</button>
                    </div>
                </div>

                <!-- LIMPEZA AUTOM√ÅTICA (TOGGLE) -->
                <div class="card" style="margin-top:15px; display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <strong>Limpeza Autom√°tica</strong>
                        <p style="font-size:0.8rem; color:#777; margin:0;">Excluir lembretes vencidos h√° 30 dias</p>
                    </div>
                    <label class="switch">
                        <input type="checkbox" id="auto-cleanup-check" onchange="toggleCleanup(this)">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="card" style="margin-top:15px;">
                    <p><strong>Gerenciar Tarefas</strong></p>
                    <button class="btn-block btn-danger" onclick="clearAllCompleted()">üßπ Limpar Todas as Conclu√≠das</button>
                </div>

                <div class="card" style="margin-top:15px;">
                    <p><strong>Relat√≥rios</strong></p>
                    <button class="btn-block btn-primary" onclick="exportPDF()">üìÑ Baixar PDF</button>
                </div>
                
                <div class="card" style="margin-top:15px;">
                    <p><strong>Backup e Restaura√ß√£o (Local)</strong></p>
                    <button class="btn-block btn-secondary" onclick="backupData()">üì• Fazer Backup (Baixar Arquivo)</button>
                    <button class="btn-block btn-secondary" onclick="triggerRestore()">üì§ Restaurar Backup (Enviar Arquivo)</button>
                    <input type="file" id="restore-input" style="display:none" accept=".json" onchange="restoreData(this)">
                </div>

                <div class="card" style="margin-top:15px;">
                    <p><strong>Conta</strong></p>
                    <p style="font-size:0.8rem; color:#777;">Logado como: <span id="settings-email"></span></p>
                    <button class="btn-block btn-secondary" onclick="appLogout()" style="color:var(--danger)">Sair da Conta</button>
                </div>
                
                <!-- PIX DISCRETO (ABA MAIS) -->
                <div class="pix-footer" onclick="openSupportModal()">
                    ‚òï Apoie o desenvolvimento (Pix)
                </div>
            </div>
        </main>

        <!-- FAB -->
        <button class="fab" onclick="openModal()">+</button>

        <!-- NAVIGATION BAR -->
        <nav>
            <button class="nav-item active" onclick="switchTab('dashboard')" id="nav-dashboard">
                <svg viewBox="0 0 24 24"><path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/></svg>
                In√≠cio
            </button>
            <button class="nav-item" onclick="switchTab('calendar')" id="nav-calendar">
                <svg viewBox="0 0 24 24"><path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.89-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.95-2-2.05-2zM5 20V9h14v11H5z"/></svg>
                Agenda
            </button>
            <button class="nav-item" onclick="switchTab('tasks')" id="nav-tasks">
                <svg viewBox="0 0 24 24"><path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/></svg>
                Tarefas
            </button>
            <button class="nav-item" onclick="switchTab('settings')" id="nav-settings">
                <svg viewBox="0 0 24 24"><path d="M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>
                Mais
            </button>
        </nav>
    </div>

    <!-- 3. MODAL ADD/EDIT -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <h3 id="modal-title" style="margin-top:0;">Novo Compromisso</h3>
            <input type="hidden" id="t-id">
            
            <div class="form-group">
                <label>T√≠tulo *</label>
                <input type="text" id="t-title" class="form-control" placeholder="Ex: Reuni√£o com Jo√£o">
            </div>
            
            <div class="form-group">
                <label>Descri√ß√£o</label>
                <textarea id="t-desc" class="form-control" rows="3" placeholder="Detalhes do lembrete..."></textarea>
            </div>

            <div style="display:flex; gap:10px;">
                <div class="form-group" style="flex:1">
                    <label>Data *</label>
                    <input type="date" id="t-date" class="form-control">
                </div>
                <div class="form-group" style="flex:1">
                    <label>Hora</label>
                    <input type="time" id="t-time" class="form-control">
                </div>
            </div>

            <!-- Op√ß√£o E-mail Cloud -->
            <div class="cloud-option">
                <input type="checkbox" id="t-send-email" onchange="toggleEmailInput()">
                <label for="t-send-email">Enviar e-mails de lembrete</label>
            </div>
            <div class="form-group hidden" id="div-email-input">
                <label>E-mail Destino</label>
                <input type="email" id="t-email-addr" class="form-control" placeholder="cliente@email.com">
                
                <!-- CONFIGURA√á√ÉO AVAN√áADA DE EMAIL -->
                <div class="advanced-settings" style="margin-top:10px;">
                    <h4>Configura√ß√£o de E-mail</h4>
                    <div class="row">
                        <div class="col">
                            <label>Anteced√™ncia (dias)</label>
                            <input type="number" id="t-mail-days" class="form-control" placeholder="Default">
                        </div>
                        <div class="col">
                            <label>Repetir (dias)</label>
                            <input type="number" id="t-mail-int" class="form-control" placeholder="Default">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <label>Atrasado: Repetir (dias)</label>
                            <input type="number" id="t-mail-over-int" class="form-control" placeholder="Default">
                        </div>
                        <div class="col">
                            <label>Max Envios (atraso)</label>
                            <input type="number" id="t-mail-max" class="form-control" placeholder="Default">
                        </div>
                    </div>
                </div>
            </div>

            <!-- CONFIGURA√á√ÉO AVAN√áADA DE ALARME -->
            <div class="advanced-settings">
                <h4>Configura√ß√£o de Alarme (App Aberto)</h4>
                <div class="row">
                    <div class="col">
                        <label>Acionar (min antes)</label>
                        <input type="number" id="t-rem-start" class="form-control" placeholder="Default">
                    </div>
                    <div class="col">
                        <label>Repetir (min)</label>
                        <input type="number" id="t-rem-int" class="form-control" placeholder="Default">
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <label>Se atrasado: Repetir (min)</label>
                        <input type="number" id="t-rem-over-int" class="form-control" placeholder="Default">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Categoria</label>
                <input type="text" id="t-category" class="form-control" list="cat-suggestions">
                <datalist id="cat-suggestions">
                    <option value="Trabalho">
                    <option value="Pessoal">
                    <option value="Cliente">
                    <option value="Fornecedor">
                </datalist>
            </div>
            <div class="form-group">
                <label>Valor R$</label>
                <input type="number" id="t-value" class="form-control" step="0.01">
            </div>

            <button class="btn-block btn-primary" onclick="saveTask()">Salvar</button>
            <button class="btn-block btn-secondary" onclick="closeModal()">Cancelar</button>
        </div>
    </div>

    <!-- 4. ALARM MODAL -->
    <div class="alarm-modal" id="alarmModal">
        <div class="alarm-card">
            <input type="hidden" id="alarm-task-id">
            <span class="alarm-icon">‚è∞</span>
            <div id="alarm-context" style="font-weight:bold; color:var(--danger); margin-bottom:5px;"></div>
            <div class="alarm-title">Lembrete!</div>
            <div id="alarm-time-display" style="font-size:1.5rem; font-weight:bold; color:var(--primary); margin:10px 0;"></div>
            <p id="alarm-text-display" style="margin-bottom:20px;"></p>
            <button class="btn-block btn-success" onclick="completeTaskFromAlarm()">‚úÖ Concluir</button>
            <button class="btn-block btn-secondary" onclick="stopAlarm()">Soneca (Silenciar)</button>
        </div>
    </div>

    <!-- 5. SUPPORT MODAL (NOVO COM COP√çA E COLA) -->
    <div class="modal" id="supportModal">
        <div class="modal-content" style="text-align: center;">
            <h3 style="color:var(--primary); margin-top:0;">Apoie o Projeto ‚òï</h3>
            <p style="font-size: 0.95rem; line-height: 1.4; color: #555; margin-bottom: 20px;">
                Este app √© gratuito. Selecione um valor para gerar o c√≥digo <b>Pix Copia e Cola</b>:
            </p>
            
            <div class="pix-grid">
                <button class="btn-pix" onclick="generatePixCopyPaste(5)">R$ 5,00</button>
                <button class="btn-pix" onclick="generatePixCopyPaste(9)">R$ 9,00</button>
                <button class="btn-pix" onclick="generatePixCopyPaste(12)">R$ 12,00</button>
                <button class="btn-pix" onclick="copyPixSimpleKey()">Outro Valor</button>
            </div>
            
            <div id="pix-feedback" style="display:none; color:green; font-weight:bold; margin-bottom:10px;">
                ‚úÖ C√≥digo copiado!
            </div>
            
            <div class="pix-key-display" id="pix-display-area" style="display:none;"></div>

            <button class="btn-block btn-secondary" onclick="closeSupportModal()">Fechar</button>
        </div>
    </div>

    <!-- Som do Alarme (Loop) -->
    <audio id="audioAlert" loop src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAUAAACzAAKCg4PEhIWFxsbHiAgIyMoKCsrLzAwMjI2Njg4Ojw8P0BAQkJERkdHSkpMTk5QUFJTU1dXV1lbW11dYGBiYmRmZmdnaGhqam5ucHBydHR3d3l5e3t9fX6AgIGBgoKFhYiIiouLkJCSkpWWlpiYmZmbm52dnp6goKGhoqKkpKWlpqeoqKmqq6ytrq6wsLGxsrK0tLe3uLi6ur29v8DAwsLGxsnJysrMzM7O0NDS0tTX19jY2dvb3Nzd3d7e4ODi4uPj5eXn5+jo6evr7Ozt7u7w8PHx8vL09PX19vf3+Pj6+vv7/Pz9/f7+/v///wAAAqpLdXJ6AAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uQxAAACkQBOAAAAAEAAAD5AAAAABj3/vT23uAgBPgAPAAAAAAAZAAAAAAAAAAAAAAB//uQxAAACkQBOAAAAAEAAAD5AAAAABj3/vT23uAgBPgAPAAAAAAAZAAAAAAAAAAAAAAB//uQxAAACkQBOAAAAAEAAAD5AAAAABj3/vT23uAgBPgAPAAAAAAAZAAAAAAAAAAAAAAB//uQxAAACkQBOAAAAAEAAAD5AAAAABj3/vT23uAgBPgAPAAAAAAAZAAAAAAAAAAAAAAB//uQxAAACkQBOAAAAAEAAAD5AAAAABj3/vT23uAgBPgAPAAAAAAAZAAAAAAAAAAAAAAB//uQxAAACkQBOAAAAAEAAAD5AAAAABj3/vT23uAgBPgAPAAAAAAAZAAAAAAAAAAAAAAB"></audio>

    <!-- Som de Conclus√£o (Ding curto) -->
    <audio id="audioDone" src="data:audio/mp3;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAAGAAABuAAKCg4PEhIWFxsbHiAgIyMoKCsrLzAwMjI2Njg4Ojw8P0BAQkJERkdHSkpMTk5QUFJTU1dXV1lbW11dYGBiYmRmZmdnaGhqam5ucHBydHR3d3l5e3t9fX6AgIGBgoKFhYiIiouLkJCSkpWWlpiYmZmbm52dnp6goKGhoqKkpKWlpqeoqKmqq6ytrq6wsLGxsrK0tLe3uLi6ur29v8DAwsLGxsnJysrMzM7O0NDS0tTX19jY2dvb3Nzd3d7e4ODi4uPj5eXn5+jo6evr7Ozt7u7w8PHx8vL09PX19vf3+Pj6+vv7/Pz9/f7+/v///wAAAD5LdXJ6AAAAAExBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uQxAAACkQBOAAAAAEAAAD5AAAAABj3/vT23uAgBPgAPAAAAAAAZAAAAAAAAAAAAAAB//uQxAAACkQBOAAAAAEAAAD5AAAAABj3/vT23uAgBPgAPAAAAAAAZAAAAAAAAAAAAAAB"></audio>

    <!-- L√ìGICA DO APP (ARQUIVO JS SEPARADO) -->
    <script src="app.js"></script>

</body>
</html>